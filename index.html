<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stick Fight Game</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #edf2f7;
        margin: 0;
        padding: 0;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      h2 {
        text-align: center;
        color: #333;
      }
      .menu-buttons {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin: 20px 0;
      }
      .menu-button {
        padding: 15px 40px;
        font-size: 18px;
        border-radius: 12px;
      }
      .rooms-list {
        background: #f8fafc;
        border-radius: 12px;
        padding: 16px;
        margin: 20px 0;
        max-height: 300px;
        overflow-y: auto;
      }
      .room-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background: white;
        margin-bottom: 8px;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
      }
      .room-item:hover {
        border-color: #667eea;
      }
      .host-setup {
        display: flex;
        gap: 12px;
        justify-content: center;
        align-items: center;
        margin: 20px 0;
      }
      #hostWait {
        text-align: center;
        margin-top: 24px;
        display: none;
      }
    </style>
</head>
<body>
  <div class="container">
    <h2>Stick Fight</h2>
    <!-- Hoofdmenu: alleen Host en Join -->
    <div id="mainMenu">
      <div style="display:flex; gap:32px; justify-content:center; margin:32px 0;">
        <button id="btnHost" style="padding:18px 48px; font-size:20px;">Host Game</button>
        <button id="btnJoin" style="padding:18px 48px; font-size:20px;">Join Game</button>
      </div>
    </div>
    <!-- Host setup: naam kiezen en starten -->
    <div id="hostSetup" style="display:none;">
      <div style="display:flex; gap:12px; justify-content:center; align-items:center; margin:32px 0;">
        <input id="playerName" placeholder="Jouw naam" value="Speler" />
        <button id="btnStartHost">Start Game</button>
        <button id="btnBackHost">Terug</button>
      </div>
      <div id="hostWait" style="text-align:center; margin-top:24px; display:none;">
        <span>Wachten op speler...</span>
      </div>
    </div>
    <!-- Join: naam kiezen en lijst met open games -->
    <div id="joinSetup" style="display:none;">
      <div style="display:flex; gap:12px; justify-content:center; align-items:center; margin:32px 0;">
        <input id="joinPlayerName" placeholder="Jouw naam" value="Speler" />
        <button id="btnRefreshRooms">Vernieuw Lijst</button>
        <button id="btnBackJoin">Terug</button>
      </div>
      <div class="rooms-list" id="roomsList">
        <div class="room-item">Klik 'Vernieuw Lijst' om games te zien</div>
      </div>
    </div>
    <!-- Game area (canvas etc) -->
    <div id="gameArea" style="display:none;">
      <!-- ...existing game UI... -->
    </div>
  </div>
  <script>
    // ...existing Firebase setup...
    (function() {
      // ...existing code...
      // UI logic
      function showMainMenu() {
        document.getElementById('mainMenu').style.display = 'block';
        document.getElementById('hostSetup').style.display = 'none';
        document.getElementById('joinSetup').style.display = 'none';
        document.getElementById('gameArea').style.display = 'none';
      }
      function showHostSetup() {
        document.getElementById('mainMenu').style.display = 'none';
        document.getElementById('hostSetup').style.display = 'block';
        document.getElementById('hostWait').style.display = 'none';
      }
      function showJoinSetup() {
        document.getElementById('mainMenu').style.display = 'none';
        document.getElementById('joinSetup').style.display = 'block';
        refreshRooms();
      }
      document.getElementById('btnHost').onclick = showHostSetup;
      document.getElementById('btnJoin').onclick = showJoinSetup;
      document.getElementById('btnBackHost').onclick = showMainMenu;
      document.getElementById('btnBackJoin').onclick = showMainMenu;

      // Host game start
      document.getElementById('btnStartHost').onclick = function() {
        const name = document.getElementById('playerName').value || 'Speler';
        const room = 'room-' + Math.random().toString(36).slice(2, 7);
        if (!window.__db) {
          console.log('Firebase niet geinitialiseerd');
          return;
        }
        game = new Game(name);
        game.startOnline(window.__db, room, true);
        document.getElementById('hostWait').style.display = 'block';
      };

      // Rooms lijst
      document.getElementById('btnRefreshRooms').onclick = refreshRooms;
      async function refreshRooms() {
        if (!window.__db) {
          console.log('Firebase niet geinitialiseerd');
          return;
        }
        const roomsList = document.getElementById('roomsList');
        roomsList.innerHTML = '<div class="room-item">Laden...</div>';
        try {
          const snap = await window.__db
            .collection('rooms')
            .where('state','==','matchmaking')
            .orderBy('updatedAt','desc')
            .limit(10)
            .get();
          if (snap.empty) {
            roomsList.innerHTML = '<div class="room-item">Geen actieve games gevonden</div>';
            return;
          }
          roomsList.innerHTML = '';
          snap.forEach(doc => {
            const data = doc.data();
            const room = doc.id.replace(/^stickfight_/, '');
            const el = document.createElement('div');
            el.className = 'room-item';
            el.innerHTML = `
              <span>${data.hostName || '?'} wacht op opponent</span>
              <button onclick="joinRoom('${room}')">Join Game</button>
            `;
            roomsList.appendChild(el);
          });
        } catch (e) {
          roomsList.innerHTML = `<div class="room-item">Error: ${e.message || 'Onbekende fout'}</div>`;
        }
      }
      window.joinRoom = function(room) {
        const name = document.getElementById('joinPlayerName').value || 'Speler';
        game = new Game(name);
        game.startOnline(window.__db, room, false);
        document.getElementById('joinSetup').style.display = 'none';
        document.getElementById('gameArea').style.display = 'block';
      };
      // Start in hoofdmenu
      showMainMenu();
      // ...existing code...
    })();
  </script>
</body>
</html>