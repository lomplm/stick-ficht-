<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stick Fight Game</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #f7fafc 100%);
        margin: 0;
        padding: 0;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      h2 {
        text-align: center;
        color: #4c1d95;
        text-shadow: 0 2px 8px #a5b4fc44;
      }
      .menu-buttons {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin: 32px 0;
      }
      .menu-button {
        padding: 15px 40px;
        font-size: 18px;
        border-radius: 12px;
        background: linear-gradient(135deg, #6366f1 0%, #a78bfa 100%);
        color: #fff;
        border: none;
        box-shadow: 0 4px 16px #6366f133;
        transition: background 0.2s, transform 0.2s;
      }
      .menu-button:hover {
        background: linear-gradient(135deg, #a78bfa 0%, #6366f1 100%);
        transform: scale(1.05);
      }
      .rooms-list {
        background: #f8fafc;
        border-radius: 12px;
        padding: 16px;
        margin: 20px 0;
        max-height: 300px;
        overflow-y: auto;
      }
      .room-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background: linear-gradient(90deg, #e0e7ff 0%, #f7fafc 100%);
        margin-bottom: 8px;
        border-radius: 8px;
        border: 1px solid #6366f1;
        color: #312e81;
      }
      .room-item:hover {
        border-color: #667eea;
      }
      .host-setup {
        display: flex;
        gap: 12px;
        justify-content: center;
        align-items: center;
        margin: 20px 0;
      }
      #hostWait {
        text-align: center;
        margin-top: 24px;
        display: none;
      }
      .room-code-box {
        background: linear-gradient(90deg, #fbbf24 0%, #f59e42 100%);
        border-radius: 8px;
        padding: 12px 24px;
        margin: 16px auto 0 auto;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        color: #fff;
        letter-spacing: 2px;
        width: fit-content;
        box-shadow: 0 2px 8px rgba(102,126,234,0.08);
        animation: pulse 1.2s infinite alternate;
      }
      @keyframes pulse {
        0% { box-shadow: 0 0 8px #fbbf24aa; }
        100% { box-shadow: 0 0 24px #fbbf24cc; }
      }
      .waiting-status {
        text-align: center;
        margin-top: 18px;
        font-size: 16px;
        color: #6366f1;
        font-weight: 600;
        animation: blink 1.2s infinite alternate;
      }
      @keyframes blink {
        0% { opacity: 1; }
        100% { opacity: 0.6; }
      }
      .room-item button {
        background: linear-gradient(135deg, #f59e42 0%, #fbbf24 100%);
        color: #fff;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        padding: 8px 18px;
        font-size: 15px;
        cursor: pointer;
        transition: background 0.2s;
        box-shadow: 0 2px 8px #fbbf2444;
      }
      .room-item button:hover {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e42 100%);
      }
      .host-setup input {
        border: 2px solid #6366f1;
        border-radius: 8px;
        padding: 10px 16px;
        font-size: 16px;
        background: #f7fafc;
        color: #312e81;
        transition: border 0.2s;
      }
      .host-setup input:focus {
        border: 2px solid #fbbf24;
        outline: none;
      }
      .host-setup button {
        background: linear-gradient(135deg, #6366f1 0%, #a78bfa 100%);
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 10px 24px;
        font-size: 16px;
        box-shadow: 0 2px 8px #6366f133;
        transition: background 0.2s, transform 0.2s;
      }
      .host-setup button:hover {
        background: linear-gradient(135deg, #a78bfa 0%, #6366f1 100%);
        transform: scale(1.05);
      }
    </style>
</head>
<body>
  <div class="container">
    <h2>Stick Fight</h2>
    <!-- Hoofdmenu: alleen Host en Join -->
    <div id="mainMenu">
      <div class="menu-buttons">
        <button id="btnHost" class="menu-button">Host Game</button>
        <button id="btnJoin" class="menu-button">Join Game</button>
      </div>
    </div>
    <!-- Host setup: naam kiezen en starten -->
    <div id="hostSetup" style="display:none;">
      <div class="host-setup">
        <input id="playerName" placeholder="Jouw naam" value="Speler" />
        <button id="btnStartHost">Start Game</button>
        <button id="btnBackHost">Terug</button>
      </div>
      <div id="hostRoomCode" class="room-code-box" style="display:none;"></div>
      <div id="hostWait" class="waiting-status" style="display:none;">
        <span id="waitText">Wachten op speler...</span>
      </div>
    </div>
    <!-- Join: naam kiezen en lijst met open games -->
    <div id="joinSetup" style="display:none;">
      <div class="host-setup">
        <input id="joinPlayerName" placeholder="Jouw naam" value="Speler" />
        <button id="btnRefreshRooms">Vernieuw Lijst</button>
        <button id="btnBackJoin">Terug</button>
      </div>
      <div class="rooms-list" id="roomsList">
        <div class="room-item">Klik 'Vernieuw Lijst' om games te zien</div>
      </div>
    </div>
    <!-- Game area (canvas etc) -->
    <div id="gameArea" style="display:none;">
      <!-- ...existing game UI... -->
    </div>
  </div>
  <script>
    // ...existing Firebase setup...
    (function() {
      // ...existing code...
      let currentRoomCode = null;
      let hostGameStarted = false;

      function showMainMenu() {
        document.getElementById('mainMenu').style.display = 'block';
        document.getElementById('hostSetup').style.display = 'none';
        document.getElementById('joinSetup').style.display = 'none';
        document.getElementById('gameArea').style.display = 'none';
        document.getElementById('hostRoomCode').style.display = 'none';
        document.getElementById('hostWait').style.display = 'none';
        hostGameStarted = false;
      }
      function showHostSetup() {
        document.getElementById('mainMenu').style.display = 'none';
        document.getElementById('hostSetup').style.display = 'block';
        document.getElementById('hostRoomCode').style.display = 'none';
        document.getElementById('hostWait').style.display = 'none';
        hostGameStarted = false;
      }
      function showJoinSetup() {
        document.getElementById('mainMenu').style.display = 'none';
        document.getElementById('joinSetup').style.display = 'block';
        refreshRooms();
      }
      document.getElementById('btnHost').onclick = showHostSetup;
      document.getElementById('btnJoin').onclick = showJoinSetup;
      document.getElementById('btnBackHost').onclick = showMainMenu;
      document.getElementById('btnBackJoin').onclick = showMainMenu;

      // Host game start
      document.getElementById('btnStartHost').onclick = async function() {
        if (hostGameStarted) return;
        hostGameStarted = true;
        const name = document.getElementById('playerName').value || 'Speler';
        // Genereer een korte, duidelijke room code
        const room = 'ROOM-' + Math.random().toString(36).substr(2, 5).toUpperCase();
        currentRoomCode = room;
        document.getElementById('hostRoomCode').textContent = `Room code: ${room}`;
        document.getElementById('hostRoomCode').style.display = 'block';
        document.getElementById('hostWait').style.display = 'block';
        document.getElementById('waitText').textContent = 'Wachten op speler...';

        if (!window.__db) {
          document.getElementById('waitText').textContent = 'Firebase niet geinitialiseerd!';
          return;
        }
        game = new Game(name);
        // Start game, maar update UI direct zodat joiners de room kunnen zien
        try {
          await game.startOnline(window.__db, room, true);
        } catch (e) {
          document.getElementById('waitText').textContent = 'Er ging iets mis met het starten van de game!';
          hostGameStarted = false;
        }
      };

      // Rooms lijst
      document.getElementById('btnRefreshRooms').onclick = refreshRooms;
      async function refreshRooms() {
        if (!window.__db) {
          console.log('Firebase niet geinitialiseerd');
          return;
        }
        const roomsList = document.getElementById('roomsList');
        roomsList.innerHTML = '<div class="room-item">Laden...</div>';
        try {
          const snap = await window.__db
            .collection('rooms')
            .where('state','==','matchmaking')
            .orderBy('updatedAt','desc')
            .limit(10)
            .get();
          if (snap.empty) {
            roomsList.innerHTML = '<div class="room-item">Geen actieve games gevonden</div>';
            return;
          }
          roomsList.innerHTML = '';
          snap.forEach(doc => {
            const data = doc.data();
            const room = doc.id.replace(/^stickfight_/, '');
            const el = document.createElement('div');
            el.className = 'room-item';
            el.innerHTML = `
              <span><b>${room}</b> â€” Host: ${data.hostName || '?'} wacht op speler</span>
              <button onclick="joinRoom('${room}')">Join Game</button>
            `;
            roomsList.appendChild(el);
          });
        } catch (e) {
          roomsList.innerHTML = `<div class="room-item">Error: ${e.message || 'Onbekende fout'}</div>`;
        }
      }
      window.joinRoom = function(room) {
        const name = document.getElementById('joinPlayerName').value || 'Speler';
        game = new Game(name);
        game.startOnline(window.__db, room, false);
        document.getElementById('joinSetup').style.display = 'none';
        document.getElementById('gameArea').style.display = 'block';
      };
      // Start in hoofdmenu
      showMainMenu();
      // ...existing code...
    })();
  </script>
</body>
</html>